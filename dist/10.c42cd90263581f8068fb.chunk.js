webpackJsonp([10],{766:function(e,t,r){var o=r(16)(r(859),r(823),null,null);o.options.__file="/Users/liyang/MyFiles/code/iview-admin-dev/src/views/page/sys/user/form.vue",o.esModule&&Object.keys(o.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),o.options.functional&&console.error("[vue-loader] form.vue: functional components are not supported with templates, they should use render functions."),e.exports=o.exports},770:function(e,t,r){"use strict";t.__esModule=!0;var o=r(110),a=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default=a.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}},771:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return JSON.parse(e)}function n(e){return(0,m.default)(e,null,"\t")}function s(e,t,r){for(var o=e.toString().length;o<t;)e+=r,o++;return e}function i(e){return/.*[\u4e00-\u9fa5]+.*$/.test(e)}function l(e,t){var r=new Date,o=r.getFullYear(),a=r.getMonth()+1;1==String(a).length&&(a="0"+String(a));var n=r.getDate(),s=o+"-"+a+"-"+n;"now"==e&&(e=s),"now"==t&&(t=s);var i=new Date(Date.parse(e)).getTime()/864e5;return new Date(Date.parse(t)).getTime()/864e5-i}function u(e,t){var r=0,o=0;e.map(function(e,t){parseFloat(e)&&(r+=1,o+=parseFloat(e))});var a=o/r;return a?a.toFixed(t):"0"}Object.defineProperty(t,"__esModule",{value:!0}),t.tool=void 0;var d=r(53),m=o(d),f=r(41),c=o(f),p=function e(t){var r;if("object"==(void 0===t?"undefined":(0,c.default)(t)))if(null===t)r=null;else if(t instanceof Array){r=[];for(var o=0,a=t.length;o<a;o++)r.push(e(t[o]))}else{r={};for(var n in t)r[n]=e(t[n])}else r=t;return r};Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e};var g={clone:p,toJson:a,toString:n,pad:s,hasChinese:i,getDateDiff:l,pingjun:u};t.tool=g},772:function(e,t,r){var o=r(16)(r(774),r(773),null,null);o.options.__file="/Users/liyang/MyFiles/code/iview-admin-dev/src/components/form/save/bar.vue",o.esModule&&Object.keys(o.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),o.options.functional&&console.error("[vue-loader] bar.vue: functional components are not supported with templates, they should use render functions."),e.exports=o.exports},773:function(e,t,r){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Card",{staticStyle:{margin:"10px auto"},attrs:{"dis-hover":""}},[r("div",{staticClass:"card-inner-m-10"},[r("Button",{attrs:{size:"large",type:"primary"},on:{click:e.save}},[e._v("保存")])],1)])},staticRenderFns:[]},e.exports.render._withStripped=!0},774:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={methods:{save:function(){this.$emit("save")}}}},778:function(e,t,r){r(157),r(111),e.exports=r(779)},779:function(e,t,r){var o=r(34),a=r(156);e.exports=r(8).getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return o(t.call(e))}},780:function(e,t,r){e.exports={default:r(778),__esModule:!0}},784:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(53),a=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default={data:function(){return{closeMe:{currentPageName:"",to:{name:"home_index"}}}},created:function(){this.closeMe.currentPageName=this.$route.name},methods:{closeMeTo:function(e){var t=e||this.closeMe.to;this.$store.commit("removeTag",this.closeMe.currentPageName),this.$store.commit("closePage",this.closeMe.currentPageName),localStorage.pageOpenedList=(0,a.default)(this.$store.state.pageOpenedList),this.$router.push(t)}}}},785:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(770),n=o(a),s=r(285),i=o(s),l=r(780),u=o(l),d=r(109),m=r(771);t.default={data:function(){return{setting:{brotherName:"home_index",mode:"new"},ready:!1,form:{}}},watch:{"$route.params":function(e){this.checkMyParams()}},created:function(){this.checkMyParams()},methods:{checkMyParams:function(){var e=this,t=function(t){if(e.dataToFrom)e.dataToFrom(t);else{e.form=m.tool.clone(e.formEmpty);var r=t.role||t,o=!0,a=!1,n=void 0;try{for(var s,l=(0,u.default)((0,i.default)(e.form));!(o=(s=l.next()).done);o=!0){var d=s.value;void 0!==r[d]&&(e.form[d]=r[d])}}catch(e){a=!0,n=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw n}}}};this.ready=!1;var r=m.tool.clone(this.$route.params);if(r.for===this.setting.myName){r.from&&(this.setting.brotherName=r.from),r.mode&&(this.setting.mode=r.mode),this.initStartHandler&&this.initStartHandler();if("new"===(r.dataGetWay||"row"))return this.form=m.tool.clone(this.formEmpty),void(0,d.axiosToken)({url:this.setting.API+"/"+r.dataGetId}).then(function(o){0===o.data.code&&(t(o.data),e.formDataMaker&&e.formDataMaker(r.data.row),e.ready=!0)});!this.paramsValidate||this.paramsValidate(r)?r.data&&r.data.row?(delete r.data.row._index,delete r.data.row._rowKey,t(r.data.row),this.formDataMaker&&this.formDataMaker(r.data.row)):this.form=m.tool.clone(this.formEmpty):(this.$Message.error("页面参数校验失败，即将自动关闭"),this.paramsErrorHandler()),this.ready=!0}else this.paramsErrorHandler()},paramsErrorHandler:function(){this.closeMeTo({name:this.setting.brotherName})},returnBrother:function(){this.closeMeTo({name:this.setting.brotherName,params:{for:this.setting.brotherName,data:{reload:!0}}})},submitHandler:function(){var e=this,t=function(t){0===t.data.code?(e.$Message.success(t.data.msg),e.returnBrother()):(e.$Message.error(t.data.msg),e.ready=!0)};if(""===this.setting.mode)return void this.$Message.error("表单状态不合法");this.$refs.form.validate(function(r){r?(e.ready=!1,"new"===e.setting.mode?(0,d.axiosToken)({url:e.setting.API,method:"post",data:(0,n.default)({},e.form)}).then(function(e){t(e)}):"edit"===e.setting.mode&&(0,d.axiosToken)({url:e.setting.API+"/"+e.form.id,method:"put",data:(0,n.default)({},e.form)}).then(function(e){t(e)})):e.$Message.error("表单校验失败")})}}}},786:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={methods:{tryFormValidate:function(e){var t=!1;return this.$refs[e].validate(function(e){t=e}),t},mixinFormReset:function(e){this.$refs[e].resetFields()}}}},823:function(e,t,r){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{position:"relative"}},[r("Input",{staticStyle:{display:"none"},model:{value:e.oldLoginName,callback:function(t){e.oldLoginName=t},expression:"oldLoginName"}}),e._v(" "),r("Form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"top"}},[r("Row",{attrs:{gutter:10}},[r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"公司名称",prop:"company.id"}},[r("OfficeMenu",{attrs:{value:e.form.company.id},on:{"update:value":function(t){e.$set(e.form.company,"id",t)}}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"部门名称",prop:"office.id"}},[r("OfficeMenu",{attrs:{value:e.form.office.id},on:{"update:value":function(t){e.$set(e.form.office,"id",t)}}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"是否允许登录",prop:"loginFlag"}},[r("DictRadio",{attrs:{value:e.form.loginFlag,type:"yes_no"},on:{"update:value":function(t){e.$set(e.form,"loginFlag",t)}}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"用户类型",prop:"userType"}},[r("DictSelect",{attrs:{value:e.form.userType,type:"sys_user_type"},on:{"update:value":function(t){e.$set(e.form,"userType",t)}}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"姓名",prop:"name"}},[r("Input",{attrs:{placeholder:"name"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"工号",prop:"no"}},[r("Input",{attrs:{placeholder:"no"},model:{value:e.form.no,callback:function(t){e.$set(e.form,"no",t)},expression:"form.no"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"登录名",prop:"loginName"}},[r("Input",{attrs:{placeholder:"loginName"},model:{value:e.form.loginName,callback:function(t){e.$set(e.form,"loginName",t)},expression:"form.loginName"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"手机",prop:"mobile"}},[r("Input",{attrs:{placeholder:"mobile"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"密码",prop:"newPassword"}},[r("Input",{attrs:{type:"password",placeholder:"newPassword"},model:{value:e.form.newPassword,callback:function(t){e.$set(e.form,"newPassword",t)},expression:"form.newPassword"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"确认密码",prop:"confirmNewPassword"}},[r("Input",{attrs:{type:"password",placeholder:"confirmNewPassword"},model:{value:e.form.confirmNewPassword,callback:function(t){e.$set(e.form,"confirmNewPassword",t)},expression:"form.confirmNewPassword"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"邮箱",prop:"email"}},[r("Input",{attrs:{placeholder:"email"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"电话",prop:"phone"}},[r("Input",{attrs:{placeholder:"phone"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"24"}},[r("FormItem",{attrs:{label:"用户角色",prop:"roleIdList"}},[r("DictCheckbox",{attrs:{value:e.form.roleIdList,type:"sys_user_type"},on:{"update:value":function(t){e.$set(e.form,"roleIdList",t)}}})],1)],1),e._v(" "),"edit"===e.setting.mode?r("Col",{attrs:{span:"8"}},[e._v("创建时间："+e._s(e.createDate))]):e._e(),e._v(" "),"edit"===e.setting.mode?r("Col",{attrs:{span:"8"}},[e._v("上次登录IP："+e._s(e.oldLoginIp))]):e._e(),e._v(" "),"edit"===e.setting.mode?r("Col",{attrs:{span:"8"}},[e._v("上次登录时间："+e._s(e.updateDate))]):e._e()],1)],1),e._v(" "),r("SaveBar",{on:{save:e.submitHandler}}),e._v(" "),e.ready?e._e():r("Spin",{attrs:{size:"large",fix:""}})],1)},staticRenderFns:[]},e.exports.render._withStripped=!0},859:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(785),n=o(a),s=r(784),i=o(s),l=r(786),u=o(l),d=r(109),m=r(772),f=o(m);t.default={name:"sys-user-form",mixins:[n.default,i.default,u.default],components:{SaveBar:f.default},data:function(){var e=this,t=function(t,r,o){if(!r)return o(new Error("必填"));(0,d.axiosToken)({url:"/a/sys/user/checkUserNo?oldNo="+e.oldNo+"&no="+e.form.no}).then(function(e){e.data?o():o(new Error("用户工号已存在"))})},r=function(t,r,o){if(!r)return o(new Error("必填"));(0,d.axiosToken)({url:"/a/sys/user/checkLoginName?oldLoginName="+e.oldLoginName+"&loginName="+e.form.loginName}).then(function(e){e.data?o():o(new Error("用户登录名已存在"))})},o=function(t,r,o){e.form.newPassword===e.form.confirmNewPassword?o():o(new Error("两次输入的密码不一致"))};return{setting:{myName:"sys-user-form",API:"/a/sys/user"},formEmpty:{id:"",company:{id:""},office:{id:""},loginFlag:"1",userType:"",name:"",no:"",loginName:"",mobile:"",newPassword:"",confirmNewPassword:"",email:"",phone:"",roleIdList:""},rules:{code:[{required:!0,message:"必填",trigger:"blur"},{validator:o,trigger:"blur"}],company:[{required:!0,message:"必填",trigger:"blur"}],office:[{required:!0,message:"必填",trigger:"blur"}],loginFlag:[{required:!0,message:"必填",trigger:"change"}],name:[{required:!0,message:"必填",trigger:"blur"}],no:[{validator:t,trigger:"blur"}],loginName:[{validator:r,trigger:"blur"}],mobile:[{required:!0,message:"必填",trigger:"blur"},{type:"string",min:11,message:"请输入一个长度最少是 11 的字符串",trigger:"blur"}],newPassword:[{required:!0,message:"必填",trigger:"blur"},{type:"string",min:3,message:"请输入一个长度最少是 3 的字符串",trigger:"blur"}],confirmNewPassword:[{required:!0,message:"必填",trigger:"blur"},{validator:o,trigger:"blur"}],email:[{type:"email",message:"请输入正确格式的邮箱",trigger:"blur"}]},createDate:"",oldLoginIp:"",updateDate:"",oldNo:"",oldLoginName:""}},created:function(){var e=this;"edit"===this.setting.mode&&((0,d.axiosToken)({url:"/a/sys/user/"+this.form.id}).then(function(t){e.form.loginFlag=t.data.user.loginFlag,e.form.userType=t.data.user.userType,e.form.name=t.data.user.name,e.form.no=t.data.user.no,e.oldNo=t.data.user.no,e.form.loginName=t.data.user.loginName,e.oldLoginName=t.data.user.loginName,e.form.mobile=t.data.user.mobile,e.form.email=t.data.user.email,e.form.phone=t.data.user.phone,e.form.roleIdList=t.data.user.roleIdList.join(","),e.createDate=t.data.user.createDate,e.oldLoginIp=t.data.user.oldLoginIp,e.updateDate=t.data.user.updateDate}),this.rules.newPassword[0].required=!1,this.rules.confirmNewPassword[0].required=!1)}}}});
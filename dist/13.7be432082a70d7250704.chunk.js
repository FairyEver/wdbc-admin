webpackJsonp([13],{770:function(e,t,r){var o=r(16)(r(871),r(829),null,null);o.options.__file="/Users/liyang/MyFiles/code/iview-admin-dev/src/views/page/sys/user/form.vue",o.esModule&&Object.keys(o.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),o.options.functional&&console.error("[vue-loader] form.vue: functional components are not supported with templates, they should use render functions."),e.exports=o.exports},774:function(e,t,r){"use strict";t.__esModule=!0;var o=r(110),a=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default=a.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}},775:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e){return JSON.parse(e)}function s(e){return(0,d.default)(e,null,"\t")}function n(e,t,r){for(var o=e.toString().length;o<t;)e+=r,o++;return e}function i(e){return/.*[\u4e00-\u9fa5]+.*$/.test(e)}function l(e,t){var r=new Date,o=r.getFullYear(),a=r.getMonth()+1;1==String(a).length&&(a="0"+String(a));var s=r.getDate(),n=o+"-"+a+"-"+s;"now"==e&&(e=n),"now"==t&&(t=n);var i=new Date(Date.parse(e)).getTime()/864e5;return new Date(Date.parse(t)).getTime()/864e5-i}function u(e,t){var r=0,o=0;e.map(function(e,t){parseFloat(e)&&(r+=1,o+=parseFloat(e))});var a=o/r;return a?a.toFixed(t):"0"}Object.defineProperty(t,"__esModule",{value:!0}),t.tool=void 0;var m=r(53),d=o(m),f=r(41),c=o(f),p=function e(t){var r;if("object"==(void 0===t?"undefined":(0,c.default)(t)))if(null===t)r=null;else if(t instanceof Array){r=[];for(var o=0,a=t.length;o<a;o++)r.push(e(t[o]))}else{r={};for(var s in t)r[s]=e(t[s])}else r=t;return r};Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e};var g={clone:p,toJson:a,toString:s,pad:n,hasChinese:i,getDateDiff:l,pingjun:u};t.tool=g},776:function(e,t,r){var o=r(16)(r(778),r(777),null,null);o.options.__file="/Users/liyang/MyFiles/code/iview-admin-dev/src/components/form/save/bar.vue",o.esModule&&Object.keys(o.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),o.options.functional&&console.error("[vue-loader] bar.vue: functional components are not supported with templates, they should use render functions."),e.exports=o.exports},777:function(e,t,r){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Card",{staticStyle:{margin:"10px auto"},attrs:{"dis-hover":""}},[r("div",{staticClass:"card-inner-m-10"},[r("Button",{attrs:{size:"large",type:"primary"},on:{click:e.save}},[e._v("保存")])],1)])},staticRenderFns:[]},e.exports.render._withStripped=!0},778:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={methods:{save:function(){this.$emit("save")}}}},782:function(e,t,r){r(158),r(111),e.exports=r(783)},783:function(e,t,r){var o=r(34),a=r(157);e.exports=r(8).getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return o(t.call(e))}},784:function(e,t,r){e.exports={default:r(782),__esModule:!0}},788:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(53),a=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default={data:function(){return{closeMe:{currentPageName:"",to:{name:"home_index"}}}},created:function(){this.closeMe.currentPageName=this.$route.name},methods:{closeMeTo:function(e){var t=e||this.closeMe.to;this.$store.commit("removeTag",this.closeMe.currentPageName),this.$store.commit("closePage",this.closeMe.currentPageName),localStorage.pageOpenedList=(0,a.default)(this.$store.state.pageOpenedList),this.$router.push(t)}}}},789:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(774),s=o(a),n=r(285),i=o(n),l=r(784),u=o(l),m=r(109),d=r(775);t.default={data:function(){return{setting:{brotherName:"home_index",mode:"new"},ready:!1,form:{}}},created:function(){this.checkMyParams()},methods:{checkMyParams:function(){var e=this,t=function(t){if(e.dataToFrom)e.dataToFrom(t);else{e.form=d.tool.clone(e.formEmpty);var r=t.role||t,o=!0,a=!1,s=void 0;try{for(var n,l=(0,u.default)((0,i.default)(e.form));!(o=(n=l.next()).done);o=!0){var m=n.value;void 0!==r[m]&&(e.form[m]=r[m])}}catch(e){a=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}}};this.ready=!1;var r=d.tool.clone(this.$route.params);if(r.for===this.setting.myName){r.from&&(this.setting.brotherName=r.from),r.mode&&(this.setting.mode=r.mode),this.initStartHandler&&this.initStartHandler();"new"===(r.dataGetWay||"row")?(this.form=d.tool.clone(this.formEmpty),(0,m.axiosToken)({url:this.setting.API+"/"+r.dataGetId}).then(function(r){t(r.data),e.ready=!0}).catch(function(t){(0,m.axiosErrorHandler)(t),e.ready=!0,e.paramsErrorHandler()})):!this.paramsValidate||this.paramsValidate(r)?r.data&&r.data.row?(delete r.data.row._index,delete r.data.row._rowKey,t(r.data.row),this.ready=!0):(this.form=d.tool.clone(this.formEmpty),this.ready=!0):(this.$Message.error("页面参数校验失败，即将自动关闭"),this.paramsErrorHandler())}else this.paramsErrorHandler()},paramsErrorHandler:function(){this.closeMeTo({name:this.setting.brotherName})},returnBrother:function(){this.closeMeTo({name:this.setting.brotherName,params:{for:this.setting.brotherName,data:{reload:!0}}})},submitHandler:function(){var e=this,t=function(t){0===t.data.code?(e.$Message.success(t.data.msg),e.returnBrother()):(e.$Message.error(t.data.msg),e.ready=!0)};if(""===this.setting.mode)return void this.$Message.error("未知提交模式");this.$refs.form.validate(function(r){if(r){e.ready=!1;var o=e.formSendDataMaker?e.formSendDataMaker():e.form;(0,m.axiosToken)({url:e.setting.API,method:"post",data:(0,s.default)({},o)}).then(function(r){t(r),"sys-menu-form"===e.setting.myName&&(0,m.axiosToken)({url:"/a/sys/nav"}).then(function(t){e.$store.commit("setPermissionList",t.data.permissionList),e.$store.commit("setNavList",t.data.menuList),e.$router.push({name:"home_index"})}).catch(function(e){return(0,m.axiosErrorHandler)(e)})}).catch(function(e){return(0,m.axiosErrorHandler)(e)})}else e.$Message.error("表单校验失败")})}}}},790:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={methods:{tryFormValidate:function(e){var t=!1;return this.$refs[e].validate(function(e){t=e}),t},mixinFormReset:function(e){this.$refs[e].resetFields()}}}},829:function(e,t,r){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{position:"relative"}},[r("Input",{staticStyle:{display:"none"},model:{value:e.oldLoginName,callback:function(t){e.oldLoginName=t},expression:"oldLoginName"}}),e._v(" "),r("Form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"top"}},[r("Row",{attrs:{gutter:10}},[r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"公司名称",prop:"company.id"}},[r("OfficeMenu",{attrs:{value:e.form.company.id},on:{"update:value":function(t){e.$set(e.form.company,"id",t)}}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"部门名称",prop:"office.id"}},[r("OfficeMenu",{attrs:{value:e.form.office.id},on:{"update:value":function(t){e.$set(e.form.office,"id",t)}}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"是否允许登录",prop:"loginFlag"}},[r("DictRadio",{attrs:{value:e.form.loginFlag,type:"yes_no"},on:{"update:value":function(t){e.$set(e.form,"loginFlag",t)}}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"用户类型",prop:"userType"}},[r("DictSelect",{attrs:{value:e.form.userType,type:"sys_user_type"},on:{"update:value":function(t){e.$set(e.form,"userType",t)}}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"姓名",prop:"name"}},[r("Input",{attrs:{placeholder:"name"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"工号",prop:"no"}},[r("Input",{attrs:{placeholder:"no"},model:{value:e.form.no,callback:function(t){e.$set(e.form,"no",t)},expression:"form.no"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"登录名",prop:"loginName"}},[r("Input",{attrs:{placeholder:"loginName"},model:{value:e.form.loginName,callback:function(t){e.$set(e.form,"loginName",t)},expression:"form.loginName"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"手机",prop:"mobile"}},[r("Input",{attrs:{placeholder:"mobile"},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"密码",prop:"newPassword"}},[r("Input",{attrs:{type:"password",placeholder:"newPassword"},model:{value:e.form.newPassword,callback:function(t){e.$set(e.form,"newPassword",t)},expression:"form.newPassword"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"确认密码",prop:"confirmNewPassword"}},[r("Input",{attrs:{type:"password",placeholder:"confirmNewPassword"},model:{value:e.form.confirmNewPassword,callback:function(t){e.$set(e.form,"confirmNewPassword",t)},expression:"form.confirmNewPassword"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"邮箱",prop:"email"}},[r("Input",{attrs:{placeholder:"email"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"4"}},[r("FormItem",{attrs:{label:"电话",prop:"phone"}},[r("Input",{attrs:{placeholder:"phone"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1)],1),e._v(" "),r("Col",{attrs:{span:"24"}},[r("FormItem",{attrs:{label:"用户角色",prop:"roleIdList"}},[r("CheckboxGroup",{model:{value:e.form.roleIdList,callback:function(t){e.$set(e.form,"roleIdList",t)},expression:"form.roleIdList"}},e._l(e.form.roleList,function(t){return r("Checkbox",{key:t.id,attrs:{label:t.id}},[e._v("\n                            "+e._s(t.name)+"\n                        ")])}))],1)],1),e._v(" "),"edit"===e.setting.mode?r("Col",{attrs:{span:"8"}},[e._v("创建时间："+e._s(e.createDate))]):e._e(),e._v(" "),"edit"===e.setting.mode?r("Col",{attrs:{span:"8"}},[e._v("上次登录IP："+e._s(e.oldLoginIp))]):e._e(),e._v(" "),"edit"===e.setting.mode?r("Col",{attrs:{span:"8"}},[e._v("上次登录时间："+e._s(e.updateDate))]):e._e()],1)],1),e._v(" "),r("SaveBar",{on:{save:e.submitHandler}}),e._v(" "),e.ready?e._e():r("Spin",{attrs:{size:"large",fix:""}})],1)},staticRenderFns:[]},e.exports.render._withStripped=!0},871:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(789),s=o(a),n=r(788),i=o(n),l=r(790),u=o(l),m=r(109),d=r(776),f=o(d);t.default={name:"sys-user-form",mixins:[s.default,i.default,u.default],components:{SaveBar:f.default},data:function(){var e=this,t=function(t,r,o){if(!r)return o(new Error("必填"));(0,m.axiosToken)({url:"/a/sys/user/checkUserNo",data:{oldNo:e.oldNo,no:e.form.no}}).then(function(e){e.data?o():o(new Error("用户工号已存在"))}).catch(function(e){return(0,m.axiosErrorHandler)(e)})},r=function(t,r,o){if(!r)return o(new Error("必填"));(0,m.axiosToken)({url:"/a/sys/user/checkLoginName",data:{oldLoginName:e.oldLoginName,loginName:e.form.loginName}}).then(function(e){e.data?o():o(new Error("用户登录名已存在"))}).catch(function(e){return(0,m.axiosErrorHandler)(e)})},o=function(t,r,o){e.form.newPassword===e.form.confirmNewPassword?o():o(new Error("两次输入的密码不一致"))};return{setting:{myName:"sys-user-form",API:"/a/sys/user"},formEmpty:{id:"",company:{id:""},office:{id:""},loginFlag:"1",userType:"",name:"",no:"",loginName:"",mobile:"",newPassword:"",confirmNewPassword:"",email:"",phone:"",roleIdList:[],roleList:[]},rules:{code:[{required:!0,message:"必填",trigger:"blur"},{validator:o,trigger:"blur"}],company:[{required:!0,message:"必填",trigger:"blur"}],office:[{required:!0,message:"必填",trigger:"blur"}],loginFlag:[{required:!0,message:"必填",trigger:"change"}],name:[{required:!0,message:"必填",trigger:"blur"}],no:[{validator:t,trigger:"blur"}],loginName:[{validator:r,trigger:"blur"}],mobile:[{required:!0,message:"必填",trigger:"blur"},{type:"string",min:11,message:"请输入一个长度最少是 11 的字符串",trigger:"blur"}],newPassword:[{required:!0,message:"必填",trigger:"blur"},{type:"string",min:3,message:"请输入一个长度最少是 3 的字符串",trigger:"blur"}],confirmNewPassword:[{required:!0,message:"必填",trigger:"blur"},{validator:o,trigger:"blur"}],email:[{type:"email",message:"请输入正确格式的邮箱",trigger:"blur"}]},createDate:"",oldLoginIp:"",updateDate:"",oldNo:"",oldLoginName:""}},created:function(){"edit"===this.setting.mode&&(this.rules.newPassword[0].required=!1,this.rules.confirmNewPassword[0].required=!1)},methods:{dataToFrom:function(e){this.form.id=e.user.id,this.form.company.id=e.user.company.id,this.form.office.id=e.user.office.id,this.form.loginFlag=e.user.loginFlag,this.form.userType=e.user.userType,this.form.name=e.user.name,this.form.no=e.user.no,this.oldNo=e.user.no,this.form.loginName=e.user.loginName,this.oldLoginName=e.user.loginName,this.form.mobile=e.user.mobile,this.form.email=e.user.email,this.form.phone=e.user.phone,this.form.roleIdList=e.user.roleIdList,this.form.roleList=e.user.roleList,this.createDate=e.user.createDate,this.oldLoginIp=e.user.oldLoginIp,this.updateDate=e.user.updateDate}}}}});